- name: テンポラリディレクトリ作成 (ansible_tmp)
  become: true
  file:
    path: /home/ken/ansible_tmp
    owner: ken
    group: staff
    state: directory

- name: アーカイブしたファイル(ディレクトリ)をコピー (ローカル → リモート)
  become: true
  copy:
    src: "/home/ken/ansible_tmp"
    dest: "/home/ken"
    owner: ken
    group: staff

- name: (解凍上書き前に) 転送先のディレクトリを削除
  become: true
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - '/home/ken/ansible'
    - '/home/ken/data'
    - '/home/ken/moodle_data'
    - '/home/ken/public_html'
    - '/var/public_smb'
    - '/var/www/html'
    - '/etc/popfile'
    - '/var/lib/popfile'

- name: アーカイブを解凍 (アーカイブ時にパス指定がルートからなのでルートで解凍)
  become: true
  command: tar xzvf "/home/ken/ansible_tmp/{{ item }}" -C /
  with_items:
    - 'ansible.tgz'
    - 'data.tgz'
    - 'moodle_data.tgz'
    - 'public_html.tgz'
    - 'public_smb.tgz'
    - 'html.tgz'
    - 'popfile_etc.tgz'
    - 'popfile_lib.tgz'
